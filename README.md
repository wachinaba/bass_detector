# ArUco マーカー姿勢推定アプリケーション

PySide6とOpenCVを使用したArUcoマーカーの検出と姿勢推定を行うアプリケーションです。

## 機能

- リアルタイムでのArUcoマーカー検出
- マーカーの姿勢推定（位置と回転）
- 複数の ArUco 辞書タイプに対応
- カメラキャリブレーションパラメータの調整
- 検出情報のリアルタイム表示
- テスト用マーカーの生成

## 必要な依存関係

```bash
pip install -r requirements.txt
```

## 使用方法

### 1. ArUcoマーカー姿勢推定アプリの起動

```bash
python bass_detector/aruco_detector.py
```

### 2. テスト用マーカーの生成

```bash
python bass_detector/aruco_marker_generator.py
```

## アプリケーションの使い方

### 基本操作

1. **カメラ開始**: 「カメラ開始」ボタンをクリックしてWebカメラを起動
2. **マーカー検出**: カメラ映像内にArUcoマーカーをかざす
3. **姿勢情報確認**: 右側パネルで検出されたマーカーの位置と回転情報を確認

### 設定項目

#### カメラ設定
- **カメラID**: 使用するカメラデバイスのID（通常は0）

#### ArUco設定
- **辞書タイプ**: 使用するArUco辞書（DICT_6X6_250が推奨）
- **マーカーサイズ**: 実際のマーカーのサイズ（メートル単位）

#### カメラキャリブレーション
- **焦点距離 (fx, fy)**: カメラの焦点距離パラメータ
- **主点 (cx, cy)**: 画像の主点座標

### 検出される情報

各マーカーについて以下の情報が表示されます：

- **マーカーID**: 検出されたマーカーの識別番号
- **位置 (X, Y, Z)**: カメラからの距離（メートル単位）
- **回転 (Roll, Pitch, Yaw)**: マーカーの姿勢角度（度単位）

## マーカー生成ツール

`aruco_marker_generator.py` を使用して、テスト用のArUcoマーカーを生成できます。

### 生成モード

1. **単一マーカー**: 指定したIDのマーカーを1つ生成
2. **複数マーカー**: 複数のIDのマーカーを個別に生成
3. **マーカーボード**: 複数のマーカーを配置したボードを生成

### 使用例

```bash
# マーカー生成ツールを起動
python bass_detector/aruco_marker_generator.py

# インタラクティブに設定を選択
# 例: ID 0-5 のマーカーボードを生成
```

## トラブルシューティング

### カメラが開けない場合
- カメラIDを変更してみてください（0, 1, 2, 3）
- 他のアプリケーションがカメラを使用していないか確認してください

### マーカーが検出されない場合
- マーカーのサイズ設定を実際のサイズに合わせてください
- 照明条件を改善してください（明るすぎず暗すぎない環境）
- マーカーが平らで歪みがないことを確認してください

### 姿勢推定の精度が低い場合
- カメラキャリブレーションパラメータを調整してください
- より大きなマーカーを使用することを検討してください
- カメラとマーカーの距離を適切に保ってください

## 技術仕様

- **GUI フレームワーク**: PySide6
- **コンピュータビジョン**: OpenCV
- **対応ArUco辞書**: DICT_4X4_50, DICT_4X4_100, DICT_4X4_250, DICT_5X5_50, DICT_6X6_50, DICT_6X6_250
- **フレームレート**: 約30 FPS
- **推奨解像度**: 640x480

## ライセンス

このプロジェクトはオープンソースです。
